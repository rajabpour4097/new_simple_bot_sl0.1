# Commission Coverage Feature

## ๐ Overview
ุงู ูฺฺฏ ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ Stop Loss ุฑุง ุจู ููุทูโุง ุจุนุฏ ุงุฒ ฺฉูุณูู ููุชูู ูโฺฉูุฏ ุชุง ุงุฒ ุถุฑุฑ ฺฉูุณูู ุฏุฑ ุตูุฑุช ุจุฑฺฏุดุช ููุช ุฌููฺฏุฑ ุดูุฏ.

## โ๏ธ How It Works

### 1. ูุญุงุณุจู ุฎูุฏฺฉุงุฑ ููุทู ฺฉูุณูู
ููุช ฺฉ ูพูุฒุดู ุจุงุฒ ูโุดูุฏ:
- **ุฑุณฺฉ ูพูู (1R)** ูุญุงุณุจู ูโุดูุฏ: `risk_money = risk_pips ร pip_value ร volume`
- **ฺฉูุณูู ุจู R** ุชุจุฏู ูโุดูุฏ: `commission_R = commission_per_lot / risk_money`
- **ุจุงูุฑ ุงุถุงู** ุงุถุงูู ูโุดูุฏ: `final_trigger = commission_R + buffer_R`

### 2. ุงูุชูุงู ุฎูุฏฺฉุงุฑ SL
ููุช ุณูุฏ ุจู `commission_R + buffer` ูโุฑุณุฏ:
- **SL** ุจู ููุงู ููุทู trigger ููุชูู ูโุดูุฏ
- **TP** ุจุฏูู ุชุบุฑ ุจุงู ูโูุงูุฏ (ููุงู 2R ุงููู)
- ุงู ุนูู **ููุท ฺฉ ุจุงุฑ** ุงูุฌุงู ูโุดูุฏ

### 3. ูุฑุงุญู ุจุนุฏ
ูพุณ ุงุฒ ูพูุดุด ฺฉูุณููุ ูุฑุงุญู 2Rุ 3Rุ 4R ู ... ุจู ููุงู ุตูุฑุช ูุจู ุงุฏุงูู ูโุงุจูุฏ.

## ๐ Configuration

ุฏุฑ `metatrader5_config.py`:

```python
DYNAMIC_RISK_CONFIG = {
    'commission_per_lot': 4.5,  # ฺฉูุณูู ฺฉู (ุฏูุงุฑ) - ุทุจู ุจุฑูฺฉุฑ ุชูุธู ฺฉูุฏ
    'commission_coverage_stage': {
        'enable': True,           # ูุนุงู/ุบุฑูุนุงู
        'commission_buffer_R': 0.15,  # ุจุงูุฑ ุงุถุงู (15% ุงุฒ 1R)
        'auto_calculate': True,   # ูุญุงุณุจู ุฎูุฏฺฉุงุฑ
    },
    'stages': [
        {
            'id': 'stage_commission_coverage',
            'trigger_R': 'auto',  # ูุญุงุณุจู ุฎูุฏฺฉุงุฑ
            'sl_lock_R': 'auto',  # ููู ุฑู ููุงู trigger
            'tp_R': None          # TP ุจุฏูู ุชุบุฑ
        },
        # ูุฑุงุญู 2R ุจู ุจุนุฏ...
    ]
}
```

## ๐ Example Scenario

ูุฑุถ ฺฉูุฏ:
- **Risk**: 1% ุงุฒ balance
- **Risk Money**: $10
- **Commission**: $4.5

ูุญุงุณุจู:
```
commission_R = 4.5 / 10 = 0.45R
buffer = 0.15R
trigger = 0.45 + 0.15 = 0.60R
```

ุฌุฑุงู ฺฉุงุฑ:
1. โ ูพูุฒุดู ุจุงุฒ ูโุดูุฏ ุจุง SL ุงุตู ู TP=2R
2. ๐ ููุช ุจู 0.60R ูโุฑุณุฏ
3. ๐ฐ SL ุจู 0.60R ููุชูู ูโุดูุฏ (TP ููฺูุงู 2R)
4. ๐ฏ ููุช ุจู 2R ูโุฑุณุฏ
5. โ๏ธ SL ุจู 2R ููุชูู ูโุดูุฏุ TP ุจู 3R ุชุบุฑ ูโฺฉูุฏ
6. ๐ ู ูููุทูุฑ ุงุฏุงูู...

## ๐ฏ Benefits

โ **ูุญุงูุธุช ุงุฒ ุณุฑูุงู**: ุญุฏุงูู ฺฉูุณูู ูพูุดุด ุฏุงุฏู ูโุดูุฏ  
โ **ุฎูุฏฺฉุงุฑ**: ูุงุฒ ุจู ูุญุงุณุจู ุฏุณุช ูุณุช  
โ **ุงูุนุทุงูโูพุฐุฑ**: buffer ูุงุจู ุชูุธู  
โ **ุจุฏูู ุชุฏุงุฎู**: TP ุงุตู ุชุบุฑ ููโฺฉูุฏ  

## โ๏ธ Important Notes

- ุงู ูฺฺฏ **ูุจู ุงุฒ ูุฑุญูู 2R** ูุนุงู ูโุดูุฏ
- ูุญุงุณุจุงุช ุจุฑ ุงุณุงุณ **volume ูุงูุน** ูพูุฒุดู ุงุณุช
- ุงฺฏุฑ ูุญุงุณุจู ูุงูููู ุจุงุดุฏุ ุจู `0.1R` ุจุฑูโฺฏุฑุฏุฏ
- ูุงฺฏโูุง ุฌุฒุฆุงุช ฺฉุงูู ูุญุงุณุจุงุช ุฑุง ููุงุด ูโุฏููุฏ

## ๐ง Troubleshooting

ุงฺฏุฑ commission coverage ูุนุงู ูุดุฏ:
1. ุจุฑุฑุณ ฺฉูุฏ `enable: True` ุจุงุดุฏ
2. ุจุฑุฑุณ ฺฉูุฏ `commission_per_lot` ุตุญุญ ุจุงุดุฏ
3. ูุงฺฏโูุง ุฑุง ุจุฑุง ูพุงู `Commission calc:` ุจุฑุฑุณ ฺฉูุฏ
4. ุงฺฏุฑ ูุงุฒู ุงุณุช `commission_buffer_R` ุฑุง ุชูุธู ฺฉูุฏ
